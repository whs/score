# API คะแนน

เอกสารนี้ไม่ได้มีเนื้อหาอื่นใดนอกจากที่พบได้ในซอร์สของโปรแกรมอยู่แล้ว หรือจะดัก Traffic เอาก็สามารถเข้าใจได้เช่นเดียวกัน

## เรียกรายการวิชา

> GET data/files.json

ไฟล์นี้เก็บรายการวิชาสอบที่จะแสดงในหน้าแรก​ในรูปแบบของ JSON Array<Object> โดยแต่ละ Object ใน Array มีดังนี้

- `id`: ค่าอ้างอิงของไฟล์นี้ สร้างจากการสุ่ม ไม่มีการเปลี่ยนแปลงนอกจากผู้ใช้จะลบทิ้ง
- `name`: ชื่อไฟล์สำหรับมนุษย์
- `uploaded`: หากมี และมีค่าเป็น 4 คือประกาศผลแล้ว หากไม่มี หรือไม่มีค่าเป็น 4 คือ ยังไม่ประกาศผล

Field `uploaded` นั้นใช้ภายในระบบระหว่างทำการประมวลผลคะแนน ฉะนั้นแล้ว หากมี Field นี้เกิดขึ้นที่เลขไม่ใช่ 4 แสดงว่ากำลังจะประกาศผล ซึ่งโดยทั่วไปแล้วโอกาสพบจะน้อยมากเพราะโปรแกรมประมวลผลค่อนข้างไว (ด้วยข้อมูลสอบจริง ปีการศึกษา 2555 ใช้เวลาประมวลผลประมาณ 10 วินาที)

## เรียกดูคะแนน

> GET data/:id/u:uid_:hash.json

แทนค่าใน URL ดังนี้:

- `:id`: ID ของไฟล์ที่ต้องการดู หาได้จาก `data/files.json`
- `:uid`: เลขประจำตัวสอบ
- `:hash`: แฮชรหัสผ่าน เกิดจากฟังก์ชั่น `hex_sha1(username+password+id).substr(0, 5)`

ตัวอย่างเช่น หากต้องการดูไฟล์ที่มี id `5133643915399` และด้วยเลขประจำตัว `11963` รหัสผ่าน `2467`
สามารถหา hash ได้ดังนี้

1. รวมข้อมูลต่อกัน ได้เป็น `1196324675133643915399`
2. เข้า SHA1 ได้เป็น `a9cd8b1f04d2164f2e475f4d085950ae38bd1100`
3. ตัดเอา 5 ตัวหน้า คือ `a9cd8` เป็นคำตอบ
4. เรียกไปที่ `data/5133643915399/u11963_a9cd8.json`

หากได้ผลลัพท์เป็น 404 Error แสดงว่าข้อมูลที่เรียกไม่ถูกต้อง เช่น ชื่อผู้ใช้งาน หรือรหัสผ่านผิด

รูปแบบของไฟล์คะแนนเป็น JSON Object ดังนี้

- `_name`: ชื่อนักเรียน
- `_fname`: ชื่อไฟล์ (มีค่าเหมือนกับ `name` ที่ออกมาจาก `data/files.json`)
- ที่เหลือเป็นข้อมูลรายวิชา มี Key เป็นชื่อวิชา และมี Value เป็น Object ดังนี้
  - `score`: คะแนนที่ได้ (อาจเป็น String)
  - `standard`: ค่ามาตรฐาน (`(Xi-Avg)/SD`)
  - `rank`: อันดับที่ ใช้แบบ 1,2,2,4,5 คือหากมีคะแนนเท่ากันจะได้ที่เท่ากัน แล้วข้ามลำดับไป
  - `percent`: เปอร์เซ็นต์จากคะแนนเต็ม
  - **หมายเหตุ**: จะมีค่าอื่นๆ นอกจาก `score` ก็ต่อเมื่อรู้คะแนนเต็ม คือ ชื่อวิชามี (..) ต่อท้าย

## เรียกดูสถิติ

> GET data/:id/stats.json

จะมีไฟล์นี้ก็ต่อเมื่อประกาศผลแล้วเท่านั้น เป็นรูปแบบ JSON Object มี Key เป็นชื่อวิชา และมี Value ของแต่ละวิชาเป็น Object ที่มีค่าดังนี้:

- `histogram`: Array ฮิสโตรแกรม คือ จำนวนคนที่ได้คะแนนนั้นๆ ตามลำดับ Array เช่น `[1,0,5,3,2]` แปลว่า มีคนได้ 0 คะแนน 1 คน ได้ 3 คะแนน 3 คน เป็นต้น
- `max`: คะแนนเต็ม (เหมือนกับในชื่อวิชา)
- `name`: ชื่อวิชา เหมือนกับ Key
- `count`: รวมจำนวนผู้เข้าสอบ มีค่าเท่ากับค่าทั้งหมดในฮิสโตรแกรมรวมกัน
- `hiscore`: คะแนนสูงสุด
- `hiscore_cnt`: จำนวนผู้ได้คะแนนสูงสุด
- `lowscore`: คะแนนต่ำสุด
- `lowscore_cnt`: จำนวนผู้ได้คะแนนต่ำสุด
- `lowscore2`: คะแนนต่ำสุดอันดับ 2
- `lowscore2_cnt`: จำนวนผู้ได้คะแนนต่ำสุดอันดับ 2
- `mode`: ฐานนิยม (คะแนนที่มีจำนวนคนได้คะแนนเท่านั้นมากที่สุด)
- `mode_cnt`: จำนวนผู้ได้คะแนนเท่ากับฐานนิยม
- `average`: คะแนนเฉลี่ย
- `sd`: ค่าเบี่ยงเบนมาตรฐาน (`(Sum(Xi^2)-N*Avg^2)/N`)

หากวิชาใดไม่มีคะแนนเต็ม (ไม่มีวงเล็บคะแนนหลังชื่อวิชา) จะไม่มีชื่อในไฟล์นี้ บางวิชาอาจมีปรากฎในไฟล์​ แต่ไม่มีปรากฎในไฟล์ของนักเรียนบางคน คือ วิชาที่นักเรียนคนนั้นไม่ได้สอบ
